# netGame
The notes of online games development.
maze war:FPS游戏的先驱
龙与地下城:RPG/大富翁类型游戏的经典
太空入侵者:入侵者类游戏鼻祖，经典的游戏编程流程
空中大战:最早的可供多人进行的游戏。
MUD:Muti User Dungeon
塞尔达传说
P2P架构：指两个或多个客户端不经过服务器而直接通信的架构。可能首先会使用服务器以让客户端间能查找到对方，但在此之后就不再需要服务器了。具体也分两种不同的形式：一种是完整连接拓扑架构，指的是每个客户端与其他客户端之间都必须有连接，信息可以直接在用户间交换；另一种是环状拓扑架构，指的是信息只有流经一个或多个客户端后才能传递过来的架构。
P2P架构
//**完整答案**
P2P架构是两个或多个客户端不经过服务器而直接通信的架构。可能首先会使用服务器以让客户端间能查找到对方，但在此之后就不再需要服务器了。具体也分两种不同的形式：一种是完整连接拓扑架构，指的是每个客户端与其他客户端之间都必须有连接，信息可以直接在用户间交换；另一种是环状拓扑架构，指的是信息只有流经一个或多个客户端后才能传递过来的架构。本文当谈到P2P架构时，指的是完整连接拓扑架构。

一般来说，P2P架构在游戏方面用的不多。很多情况下游戏似乎是在使用P2P架构，但实际上其中的一个玩家已被设定为主机来充当服务器的角色。然而，P2P架构非常适用于搭建文件共享网络。通过它，网络游戏经常能够高效地为玩家们发放游戏补丁（比如《魔兽世界》），这不仅减轻了Web服务器的负担，而且也加速了玩家下载补丁的速度。

与C/S架构相比，P2P架构技术有几个明显的优势，当然也存在几个缺点。先讲讲它的优点。

P2P架构的优点

         延时较小。延时就是指信息在从发出到接收这个过程中所用的传输时间。
         在C/S模式中，信息是先从一个客户端传到服务器端，而后再从服务器端传到另一个客户端。
         但P2P架构则是让信息直接在两个客户端间传递，这样就比C/S模式减少了一半的传递时间。
         不需要服务器端。既然P2P架构全是由客户端建成的，因此也就没必要使用服务器端。
         这对于无论是游戏开发者还是发布者来说都是一件好事，因为他们不用再为维持运行游戏中央服务器而支付主机托管和管理费了。

P2P架构的缺点：

         游戏的可扩展性差。当游戏的客户端相当少的时候，那就用P2P吧，因为它产生的延时很小且不需要使用服务器端。
         但是当游戏有很多客户端时，比如说成百或上千个客户端，那么P2P架构就不适用了。
         因为它需要每个客户端都和其他客户端保持一个独立的连接。
         那么如果有1000个客户端的话，完整拓扑架构就要求每一个客户端都要建立并维持1000个开放的连接，
         其中每一个客户端都要接受来自其他客户端发出的所有信息。
         而在C/S架构中，一个客户端只从服务器端接受经其职能筛选和归集后的信息。
         另外，还要考虑一下此种网络的应用环境。假设你有1000个客户端，但是它们全都在学校的子网络中，
         1000个用户彼此相连导致产生了1000000个连接，这将会使网络因不堪重负而瘫痪。
         但是如果同样数目的连接放到全球互联网上，则根本不会出任何问题。
         争议解决机制不健全。加入有个双人P2P游戏，每一方都能操纵鼠标去吃奶酪。
         玩家A接近第一块奶酪，然后确定离它足够近时就可以吃了它，于是玩家A因为吃了奶酪而获得了一定的积分，
         然后他传递信息给玩家B，告诉B：这块奶酪已经被我吃了。玩家B接收并处理了这条信息后从自己的屏幕上删除了那块奶酪，
         并且更新了玩家A的得分。谁都没有异议，两个客户端对当前游戏的状态达成了一致。
         但比如说现在玩家A和玩家B都在对下一块奶酪跃跃欲试。不巧的是这一次他们相互之间逻辑决策的时间就差了几毫秒，
         双方都各自认定是自己吃了这块奶酪，然后都给自己加上了分，然后互发信息给对方证明是自己把奶酪吃了。结果两个玩家就会互不相让。

         所以，P2P架构的一个缺点就是：没有中心逻辑决策者。还有一些范例更能说明问题。

ü  两个战斗到最后的玩家间互发了一个必杀技，谁先倒下？

ü  在赛车游戏中，谁第一个冲过终点？

ü  玩家争着抢地上的钥匙，哪一位先抢到呢？

处理此类问题最好的方法就是采用C/S架构，让服务器来维护游戏运行中的状态，充当逻辑决策争议的逻辑决策者。

P2P架构可通过选派一个客户端充当主机（但其本身还是P2P架构中的一个客户端）来解决逻辑争端，而这样做会带来下面两个新麻烦。
（1）如果所有重要的逻辑冲突都要通过充当主机的客户端来解决的话，那就丧失了对等网络架构的延时较低这个优点，因为信息要从客户端传到主机由其处理完后再传回客户端。
（2）P2P架构游戏本身存在安全隐患，因为所有的重要逻辑行为都运行在客户端而没有在一个中央结点得到验证。那么如果你把所有重要的逻辑决策权都交给主机的话，无疑会使这个特殊的客户端在理论上具有了某种控制能力上的优势（作弊的机会大大增加）。

支持网络游戏的技术：物理结构X逻辑结构
物理结构：C/S架构、P2P架构。
逻辑结构：MMO架构(Massively Multiplayer Online)、MO架构(Multi_player Online)。
C/S+MO:休闲游戏
C/S+MMO:MMORPG/虚拟世界、大战
P2P+MO:ARPG、对战格斗游戏、FPS、竞速游戏、RTS（即时战略游戏）、射击游戏
P2P+MMO:无
                  C/S      P2P
延迟：              大      小
服务器设备成本：     大      小
带款成本：         （根据游戏内容决定）
非法行为：          困难     容易
MO的游戏核心：少量玩家聚集在一起竞赛（20左右）
MMO的游戏核心：大量玩家进行社交活动（200-100000）

C/C架构和P2P架构
基本的网络拓扑结构：
环型、线型、网状、星型、全网状、树型、总线型
P2P架构常用全网状、星型、总线型。
C/SMMO架构常用星型结构。（因为其他的结构在节点和节点之间都存在两条以上的线路，通信延迟较大）

物理架构的种类：
C/S架构（客户端/服务端架构）
P2P架构
C/S+P2混合型架构
ad-hoc模式（所有节点平行）


逻辑架构：
[同步方式：获得全体玩家信息后，游戏才能继续]-不能中途加入游戏
[异步方式：接受歌终端上游戏状态的不一致]-可能产生不一致的结果（解决：增加玩家的满意度；使用专门的协调软件控制互斥现象）
MO：2-100人；常用在FPS和RTS（Real-time Strategy即时战略）
    架构：同步方式/全网状结构
         同步方式/星型结构
         异步方式/全网状结构
         异步方式/星型结构
MMO：成百上千的玩家数量；游戏数据是永久性的。
    架构：浏览器方式、纯粹的C/S模式
    
    
*网络开发的基本流程：反正要很多项目文档。和开发人员相关的是“详细设计文档”、类图、数据库设计图等等。

节选：4.13.1如何开始编程，如何继续编程。
数据结构有限原则：构成游戏世界的数据结构又在编写代码之前大致决定下来。
维持可玩状态原则：经常试玩游戏，在对游戏的可玩状态进行确认后进行开发。
后端服务器延后原则：整个系统并非一下子能构建出来，而是以客户端->前端游戏服务器->后端服务器的顺序，从最靠近终端用户的一端开始开发。特别是后端服务器的开发要尽可能靠后。
持续测定原则：经常对延迟、带宽、CPU时间进行测定，将其表现出来，一次为参照进行开发。


第五章【实践】P2P MO游戏开发——ARPG/FPS/竞速游戏/格斗对战游戏
这类游戏有动作游戏的特点。动作游戏的游戏状态频繁发生变化，会产生大量数据交换，若用C/S方式实现，对服务器、带宽等成本要求过高。从商业角度考虑是不可行的。(目前服务器硬件以及宽带成本不断降低，经济角度的考虑越来越弱）


RPC：远程过程调用，它是一种通过网络从远程计算机程序上请求服务，而不需要了解底层网络技术的协议。
共享内存：数据对象同步和时间通信。

RPC开发方式面向的是MMO游戏。共享内存更适合MO游戏。
比较：

                     RPC开发方式       共享内存开发方式（尽量选这种）
通信量 ---------------最小限度   -------会有多余的通信
CPU负荷               最小限度          少量多余的运算量
最大同时连接  ----------数千   --------- 数十到100             
开发难易度             复杂              简单但代码量大
通信延迟---------------------没有区别-------                       
游戏类型               即时性低          即时性高
游戏数据规模----------数据量大（对象数百万以上）--数据量小（几百到几千）
通信方式              一对多             1对全部
数据同步的开发时机-----在最开始需要开发----可以在单机版之后扩展

*P2P MO游戏的特点：
1.不需要大量数据交互（相关资源在本机中）
2.配置信息对玩家可见（跟踪内存信息，逆向破解全部游戏内容）
3.不能严格保证游戏数据变更的安全性。（可以作弊）
4.不能进行P2P连接的NAT网络环境有很多。
5.不能简单地更新游戏（someone play old version）
6.不方便结合社交网络等网络服务
7.玩家掉线的情况比较多（游戏通信依赖于玩家的机器，通信容易中断，数据量过大是不可行的）。
*优点：
1.延迟少
2.服务器的带宽负荷低（甚至没有负荷）
3.服务器硬件成本低（甚至零成本）
4.服务器维护期间也可以正常进行游戏。
